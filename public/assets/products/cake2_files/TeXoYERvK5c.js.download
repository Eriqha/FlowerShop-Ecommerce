;/*FB_PKG_DELIM*/

__d("LSCleanUpOnRecall",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.sequence([function(r){return t.db.table(12).fetch([[[e[0]]],"messageId"]).next().then(function(e,t){var r=e.done,o=e.value;return r?n[0]=!1:(t=o.item,n[0]=t.isUnsent)})},function(r){return n[0]?t.forEach(t.db.table(322).fetch([[[e[0]]],"originalMsgPkEditTs"]),function(e){return e.delete()}):t.resolve()},function(r){return n[0]?t.forEach(t.filter(t.db.table(21).fetch(),function(t){return t.messageId===e[0]}),function(e){return e.delete()}):t.resolve()},function(r){return n[0]?t.forEach(t.db.table(336).fetch([[[e[0]]]]),function(e){return e.delete()}):t.resolve()}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxCleanUpOnRecallStoredProcedure",e.__tables__=["messages","edit_message_history","m_suggestions","support_translation_feedback"],a.exports=e}),null);